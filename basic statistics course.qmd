---
title: "Periodontal Disease and Birthweight"
author: "Samuel Christen"
format: html
editor: visual
---

```{r}
library(medicaldata) 
library(knitr) 
library(ggplot2) 
library(ggcorrplot)
library(tidyverse)

maternal_data <- opt
```

## Introduction

I have used the *opt* dataset from the *medicaldata* package. This dataset was generated by a randomized controlled trial, investigating whether periodontal disease can reduce risk of preterm birth and low birth weight. I have taken on the second part of the objective and looked into whether there is an influence on birth weight.

## Description of dataset

```{r}
mean_bw <- mean(maternal_data$Birthweight, na.rm = TRUE) 
mean_bw <- mean(maternal_data$Birthweight, na.rm= TRUE) 
median_bw <- median(maternal_data$Birthweight, na.rm = TRUE) 
sd_bw <- sd(maternal_data$Birthweight, na.rm = TRUE) 
range_bw <- range(maternal_data$Birthweight, na.rm = TRUE)
summary(maternal_data$Birthweight)
```

The mean of all birthweight values is 3199, the median is 3265. Values range from 101 to 5160.

```{r}
Histogram_all <- ggplot(data = maternal_data, mapping = aes(x= Birthweight)) + 
  geom_histogram(binwidth = 100) + theme_bw() + 
  geom_vline(aes(xintercept=mean_bw), color="red") + 
  geom_vline(aes(xintercept=median_bw), color="blue")
show(Histogram_all)
```

```{r}
maternal_data %>% ggplot(aes(sample = Birthweight)) + 
  geom_qq_line(distribution = stats::qnorm) + 
  geom_qq(color = "steelblue", distribution = stats::qnorm) + 
  xlab("Theoretical Quantiles") + 
  ylab("Sample Quantiles") + 
  theme_bw()
```

```{r}
shapiro.test(maternal_data$Birthweight)
```

Birthweight is not normally distributed. Especially at low weight, there are many outliers. This might have to do with birth outcome. I therefore filtered for only live-births as birth outcome.

```{r}
maternal_data$Birth.outcome <- gsub("Live birth", "Live_birth", maternal_data$Birth.outcome) 
maternal_data <- maternal_data[maternal_data$Birth.outcome == "Live_birth          ", ] 
maternal_data <- maternal_data[trimws(maternal_data$Birth.outcome) == "Live_birth", ]
```

Check histogram again

```{r}
mean_bw_live <- mean(maternal_data$Birthweight, na.rm = TRUE) 
median_bw_live <- median(maternal_data$Birthweight, na.rm = TRUE) 
sd_bw_live <- sd(maternal_data$Birthweight, na.rm = TRUE) 
Histogram_live <- ggplot(data = maternal_data, mapping = aes(x= Birthweight)) + 
  geom_histogram(binwidth = 100) + 
  theme_bw() + 
  geom_vline(aes(xintercept=mean_bw_live), color="red") + 
  geom_vline(aes(xintercept=median_bw_live), color="blue")
show(Histogram_live)
```

Data looks more normally distributed, less outliers at the lower values.

Check QQ Plot again

```{r}
maternal_data %>% ggplot(aes(sample = Birthweight)) + geom_qq_line(distribution = stats::qnorm) + geom_qq(color = "steelblue", distribution = stats::qnorm) + xlab("Theoretical Quantiles") + ylab("Sample Quantiles") + theme_bw()
```

```{r}
shapiro.test(maternal_data$Birthweight)
```

However, data is still not normally distributed

## Statistical exploration

So let's have a look at the boxplots, if the birthweight is different based on the group (treatment vs. control group)

```{r}
ggplot(data = maternal_data, mapping = aes(y= Birthweight)) + geom_boxplot() + 
  theme_bw() + facet_grid(~Group)
```

Both treatments look very similar in terms of bodyweight and we can already tell here that there is no difference of the means between these two groups. However, let's continue

We firstly need to calculate the standard error of the mean and the CI intervals

```{r}
SE_bw <- sd_bw  
sqrt(length(which(!is.na(maternal_data$Birthweight)))) 
zValue <- qnorm(0.975)

lowerCI_mean_bw <- mean_bw - zValue * SE_bw

upperCI_mean_bw <- mean_bw + zValue * SE_bw

cbind(mean_bw, lowerCI_mean_bw, upperCI_mean_bw)
```

Sample group variances

```{r}
var_bw_control <- var(maternal_data$Birthweight[maternal_data$Group == "C"], na.rm = TRUE)

var_bw_treatment <- var(maternal_data$Birthweight[maternal_data$Group == "T"], na.rm = TRUE)
```

Sample group means and medians

```{r}
mean_bw_control <- mean(maternal_data$Birthweight[maternal_data$Group == "C"], na.rm = TRUE) 
median_bw_control <- median(maternal_data$Birthweight[maternal_data$Group == "C"], na.rm = TRUE) 
mean_bw_treatment <- mean(maternal_data$Birthweight[maternal_data$Group == "T"], na.rm = TRUE) 
median_bw_treatment <- median(maternal_data$Birthweight[maternal_data$Group == "T"], na.rm = TRUE)
```

Sample size of the groups

```{r}
n_treatment <- sum(!is.na(maternal_data$Birthweight[maternal_data$Group == "T"])) 
n_control <- sum(!is.na(maternal_data$Birthweight[maternal_data$Group == "C"]))
```

CIs for the difference in group means

```{r}
diff_mean_bw <- mean_bw_treatment - mean_bw_control

var_diff_mean_bw <- ((n_control - 1) * var_bw_control + (n_treatment - 1) * var_bw_treatment) / (n_control + n_treatment - 2)

SE_diff_mean_bw <- sqrt(var_diff_mean_bw) * sqrt(1/n_treatment + 1/n_control)

tQuantile_diff <- qt(p = 0.975, df = n_control + n_treatment - 2)

lowerCI_diff_mean_bw <- diff_mean_bw - tQuantile_diff * SE_diff_mean_bw

upperCI_diff_mean_bw <- diff_mean_bw + tQuantile_diff * SE_diff_mean_bw

cbind(diff_mean_bw, lowerCI_diff_mean_bw, upperCI_diff_mean_bw)
```

#The Birthweight of Babies in Women treated of maternal periodontal disease are 21g lower than in control. We are 95% certain it is between -102 and 60

## Explore Correlation

```{r}
cor_matrix <- maternal_data %>% dplyr::select(Birthweight, Age, BMI, N.qualifying.teeth, BL.GE, GA.at.outcome) %>% cor(use = "complete.obs", method = "spearman")

cor_matrix %>% kable(digits = 2)

ggcorrplot(cor_matrix, type = "lower", lab = TRUE)
```

GA.at.outcome (gestational age at outcome) seems to correlate with BL.GE (gerenal inflammation in Gingiva). However it is only 0.49 and therefore not very strong. N.qualifying.teeth (how many teeth had to be removed) is also mildly correlating with BL.GE, which makes sense, as the stronger the inflammation, the more teeth need to be removed.

## Statistical test

two groups, non-normally distributed, not paired

```{r}
wilcox.test(Birthweight~Group, data = maternal_data)
```

Birthweight does not differ based on periodontal disease treatment
